/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "rpc.h"
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <time.h>

void get_time();

client_data messages[100] = {{-1, ""}};
int client_req_num = 0;
int count = 0;
int current_client_id;

int *put_1_svc(struct client_data *argp, struct svc_req *rqstp) {
	static int  result;
	int id = argp->client_id;
	current_client_id = argp->client_id;

	messages[client_req_num] = *argp;
	count++;

	result = printf("Server Received: %s, %d\n", messages[client_req_num].client_msg, messages[client_req_num].client_id);
	client_req_num++;
	return (&result);
}

int *get_1_svc(void *argp, struct svc_req *rqstp) {
	static int  result;

	if(count == 0) {
		result = -1;
		return &result;
	}

//	result = printf("Server Msg: %s\n", messages[0].client_msg);

	int found_msg = 0;
	int i;
	for(i = 0; i < client_req_num; i++) {
		int id = messages[i].client_id;

		// do not retrieve your own message
		if(id != current_client_id) {
			found_msg = 1;
			result = printf("Server Retrieved Msg: %s\n", messages[i].client_msg);
			break;
		}
	}

	if(found_msg == 0) {
//		result = -1;
		result = printf("Server: No messages for client #%d.\n", current_client_id);
	}
	return &result;
}


void get_time() {
	time_t rawtime;
	struct tm *timeinfo;

	time (&rawtime);
	timeinfo = localtime(&rawtime);
	printf ( "Current local time and date: %s", asctime(timeinfo));
}